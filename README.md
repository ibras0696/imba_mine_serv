# Minecraft Forge 1.20.1 Server Toolkit (проектная заготовка)

Привет! Это черновой репозиторий, который мы собираемся превратить в удобный набор скриптов и инструкций для запуска **Forge 1.20.1** сервера. Сейчас тут только структура и план. Ниже — как ориентироваться.

## Зачем это всё

- поднять сервер одной командой (`make up`);
- хранить все настройки в `.env`;
- отделить моды для сервера и для клиента;
- запускать всё внутри Docker/Compose, чтобы было одинаково и на Windows, и на Linux.

## Структура (на 1‑й спринт)

| Папка/файл     | Что лежит                                        |
|----------------|--------------------------------------------------|
| `compose/`     | будущий `docker-compose.yml` и сопутствующие     |
| `docker/`      | Dockerfile, скрипты сборки образа                |
| `mods/server/` | `.jar` серверных модов                           |
| `mods/client/` | списки клиентских модов (md/json)                |
| `env/`         | `.env.example`, `local.env`, `production.env`    |
| `docs/`        | документация, например `modpack.md`              |
| `git/`         | всё, что пригодится для Git (хуки, шаблоны)      |
| `Makefile`     | будет CLI-слой для админа                        |
| `PLAN.md`      | подробное ТЗ/роадмап (добавим на этом шаге)      |

Пока большинство файлов пустые — дальше мы их заполним.

## Документация по модам

- Список модов теперь хранится в `docs/modpack.md`. Там таблицы по категориям, зависимостям и подсказкам для игроков.
- Если нужно объяснить игрокам, что ставить на клиент, просто дай ссылку на этот файл.
- Для игроков-новичков есть отдельный гайд `docs/player-guide.md` – там описано, как установить Forge, скопировать моды и зайти на сервер.
- Есть упрощённый скрипт для игрока: `bash git/scripts/install_client_mods.sh /путь/к/.minecraft/mods`. Он вызовет `make fetch-mods`, возьмёт все `.jar` из `mods/server` + `mods/client` и скопирует их в указанную папку. (На Windows просто открой Git Bash и выполни эту команду.)

## Автоматическая загрузка модов

### 1. Modrinth API (по списку из `docs/modpack.md`)

- Моды перечислены в `mods/sources/modrinth-server.json` и `mods/sources/modrinth-client.json`.
- Скрипт `git/scripts/fetch_modrinth.py` сам обращается к Modrinth API, берёт последнюю версию под Forge `1.20.1` и скачивает `.jar` в правильную папку.
- Пример запуска (на Windows используем `py`, на Linux можно `python3`):

```bash
make fetch-mods            # автоматический режим (Modrinth + CurseForge)
# или вручную:
py git/scripts/fetch_modrinth.py server
py git/scripts/fetch_modrinth.py client
```

- Все реальные URL фиксируются в `mods/sources/download_log.csv` (там видно версию, ссылку и куда файл положен).
- Если мода нет на Modrinth (например, Immersive Engineering, FTB Ultimine) или версия отсутствует (Flywheel теперь вшит в Create), скрипт напишет `[error]`/`[warn]`. Такие моды нужно скачать вручную и положить в `mods/server`, либо добавить прямые ссылки в ручной список (см. ниже).
- Версию Minecraft/загрузчик можно переопределить переменными `MINECRAFT_VERSION` и `MINECRAFT_LOADER`.
- Логи помогают понять, какая версия была скачана. Лежат в `mods/sources/download_log.csv`.

### 2. Ручные прямые ссылки

Если мода нет на Modrinth, используем fallback-скрипт `git/scripts/download_mods.sh`: в `mods/sources/server-mods.txt` / `mods/sources/client-mods.txt` указываем прямые URL (например, с CurseForge) и выполняем:

```bash
bash git/scripts/download_mods.sh
```

Скрипт использует `curl`/`wget`, сохраняет файлы и ничего не скачивает повторно.

### 3. Forge installer

```bash
bash git/scripts/download_forge.sh 1.20.1 47.2.0
```

Сохраняет оригинальный Forge installer в `docker/artifacts/` (вдруг решим собрать собственный образ).

### 4. CurseForge API (для модов без прямых ссылок)

- Заполни `mods/sources/curseforge.json` (пример уже добавлен для `FTB Ultimine`).
- Получи API-ключ: https://console.curseforge.com/ и впиши его в `env/local.env` (строка `CURSEFORGE_API_KEY=`). Реальное значение не коммитим.
- Запусти `make fetch-mods` или напрямую:

```bash
py git/scripts/fetch_curseforge.py
```

Скрипт сам найдёт свежую версию под Minecraft `1.20.1`, скачает `.jar` в `mods/server` и добавит запись в `download_log.csv`. Если ключа нет, он вежливо напомнит.

## Работа с `.env` (для чайника)

1. **Шаблон** — `env/.env.example`. Его нельзя трогать, он всегда актуальный.
2. **Локальный запуск** — копируй шаблон в `env/local.env`: `cp env/.env.example env/local.env`.
3. **Прод-сервер** — копируй в `env/production.env` и меняй значения под удалённый хост.
4. Минимум, что нужно заполнить: `SERVER_PORT`, `EULA=TRUE`, `SERVER_NAME`, `MEMORY_MIN/MAX`, при необходимости `OPS=Nickname1,Nickname2`.
5. Если сервер крутится на удалённом хосте, убедись, что **IPv4-адрес открыт наружу** и порт из `SERVER_PORT` проброшен в фаерволе/роутере (иначе игроки не подключатся). Никакой IP в `.env` указывать не нужно — просто сообщай игрокам внешний адрес (например, `123.45.67.89:25565`).
6. Остальные параметры (`DIFFICULTY`, `MAX_PLAYERS` и т.д.) можно править позже — главное, чтобы строки были без пробелов и кавычек.
7. Никогда не коммить реальные `.env` — добавим их в `.gitignore`, а нужные значения описываем в документации.
8. Для выдачи админки используй `OPS=Player1,Player2` — образ автоматически обновит `ops.json`.

### Как открыть порт

> Продакшен/боевой деплой планируем исключительно на Linux-серверах (VPS/dedicated). Windows-инструкции оставлены только для локальных тестов. Полный гайд смотри в `docs/deploy-linux.md`.

1. **На Linux-сервере (VPS)**
   - Разреши порт в `ufw`: `sudo ufw allow 25565/tcp`.
   - Если используешь `firewalld`: `sudo firewall-cmd --add-port=25565/tcp --permanent && sudo firewall-cmd --reload`.
   - Проверь хостинг-панель (DigitalOcean/AWS и т.п.) — там может быть свой security group, тоже добавь правило.
2. **На Windows + Docker Desktop (локальные тесты)**
   - Убедись, что Docker слушает на `0.0.0.0`.
   - В Windows Firewall добавь входящее правило для TCP-порта из `SERVER_PORT`.
   - Если за NAT, пробрось порт на роутере.
3. **Проверка**
   - После запуска `make up` зайди на внешний IP с другого устройства (`minecraft.example.com:25565`).
   - Можно протестировать через `nmap your.ip -p 25565` или сервисы типа canyouseeme.org.

## Деплой на Linux (кратко)

1. SSH на сервер → `curl -fsSL https://get.docker.com | sh` → добавить пользователя в группу docker.
2. `git clone <repo>` и перейти в каталог.
3. `cp env/.env.example env/production.env` и заполнить значения.
4. Открыть порт 25565/TCP (`ufw`/`firewalld`/Security Group).
5. `make up ENV_FILE=env/production.env`.
6. Проверить `make logs` + подключение клиента по IP:порт.

> Подробный чек-лист и инструкции лежат в `docs/deploy-linux.md`. Там же подсказки по бэкапам и обновлениям.

Если что-то не работает — убедись, что контейнер запущен (`make ps`), в логах нет ошибок (`make logs`), и порт действительно открыт во всех слоях (Docker → ОС → роутер → провайдер).

## Makefile-команды (план без реализации)

Пока нет самого `Makefile`, но UX мы уже определили. Команды будут простыми:

- `make up` — создать контейнер и запустить сервер.
- `make down` — остановить и удалить контейнер (оставляя миры).
- `make restart` — быстрый перезапуск (вызывает `down` + `up`).
- `make logs` — показать логи сервера в реальном времени.
- `make ps` — статус контейнера и портов.
- `make clean` — снести контейнер и связанные тома (использовать осторожно).
- `make rebuild` — пересобрать Docker-образ, если меняли Dockerfile.

На будущее (в отдельном спринте) хотим добавить `make backup`, `make restore`, `make update-mods`, но сначала реализуем базовый набор.

## Как читать план

В `PLAN.md` лежит полный документ: требования, стек, структура проекта, политика по `.env`, модам, Makefile-командам, план тестирования и дорожная карта. Он написан “по-русски и для чайника”, с комментариями по каждому разделу.

## Что дальше

1. **Спринт 1** ✅ — структура репо + базовый план (`PLAN.md`).
2. **Спринт 2** (в работе) — документация по модам, описание Makefile-команд и `.env`.
3. **Спринт 3** — добавить шаблоны (Makefile, Compose, Dockerfile) и инструкции по запуску.

Команды `make` и Docker-часть появятся после утверждения плана. Если нужно что-то поменять — просто скажи, и поправим до того, как перейдём к реализации.

---

**Важно:** этот проект специально задуман без CI/CD и прочей “магии”. Всё будет максимально просто и прозрачно: скачал репо, поправил `.env`, положил моды, запустил `make up`.
