services:
  minecraft:
    container_name: forge-server
    mem_limit: "${MEMORY_MAX:-31g}"
    cpus: "${SERVER_CPUS:-4}"
    build:
      context: .
      dockerfile: docker/Dockerfile
      args:
        MC_VERSION: "${MC_VERSION:-1.20.1}"
    restart: unless-stopped
    ports:
      - "${SERVER_PORT:-25565}:25565"
    environment:
      EULA: "${EULA}"
      TYPE: "FORGE"
      VERSION: "${MC_VERSION:-1.20.1}"
      FORGE_INSTALLER: "${FORGE_INSTALLER}"
      INIT_MEMORY: "${MEMORY_MIN}"
      MAX_MEMORY: "${MEMORY_MAX}"
      SERVER_NAME: "${SERVER_NAME}"
      DIFFICULTY: "${DIFFICULTY}"
      MAX_PLAYERS: "${MAX_PLAYERS}"
      ONLINE_MODE: "${ONLINE_MODE}"
      LEVEL_NAME: "${LEVEL_NAME}"
      VIEW_DISTANCE: "${VIEW_DISTANCE}"
      ALLOW_NETHER: "${ALLOW_NETHER}"
      ALLOW_FLIGHT: "${ALLOW_FLIGHT}"
      PVP: "${PVP}"
      ENABLE_COMMAND_BLOCK: "${ENABLE_COMMAND_BLOCK}"
      OPS: "${OPS}"
    volumes:
      - ./data/main:/data
      - ./config:/data/config
      - ./mods/server:/data/mods
      - ./docker/artifacts:/data/artifacts

  minecraft_shooter:
    container_name: forge-server-shooter
    mem_limit: "${SHOOTER_MEMORY_MAX:-16g}"
    cpus: "${SHOOTER_CPUS:-4}"
    build:
      context: .
      dockerfile: docker/Dockerfile
      args:
        MC_VERSION: "${SHOOTER_MC_VERSION:-1.20.1}"
    restart: unless-stopped
    ports:
      - "${SHOOTER_SERVER_PORT:-25566}:25565"
    environment:
      EULA: "${SHOOTER_EULA}"
      TYPE: "FORGE"
      VERSION: "${SHOOTER_MC_VERSION:-1.20.1}"
      FORGE_INSTALLER: "${SHOOTER_FORGE_INSTALLER}"
      INIT_MEMORY: "${SHOOTER_MEMORY_MIN}"
      MAX_MEMORY: "${SHOOTER_MEMORY_MAX}"
      SERVER_NAME: "${SHOOTER_SERVER_NAME}"
      DIFFICULTY: "${SHOOTER_DIFFICULTY}"
      MAX_PLAYERS: "${SHOOTER_MAX_PLAYERS}"
      ONLINE_MODE: "${SHOOTER_ONLINE_MODE}"
      LEVEL_NAME: "${SHOOTER_LEVEL_NAME}"
      VIEW_DISTANCE: "${SHOOTER_VIEW_DISTANCE}"
      ALLOW_NETHER: "${SHOOTER_ALLOW_NETHER}"
      ALLOW_FLIGHT: "${SHOOTER_ALLOW_FLIGHT}"
      PVP: "${SHOOTER_PVP}"
      ENABLE_COMMAND_BLOCK: "${SHOOTER_ENABLE_COMMAND_BLOCK}"
      OPS: "${SHOOTER_OPS}"
    volumes:
      - ./data/shooter:/data
      - ./config:/data/config
      - ./mods/server:/data/mods
      - ./docker/artifacts:/data/artifacts

  minecraft_vanilla:
    container_name: forge-server-vanilla
    mem_limit: "${VANILLA_MEMORY_MAX:-15g}"
    cpus: "${VANILLA_CPUS:-4}"
    build:
      context: .
      dockerfile: docker/Dockerfile
      args:
        MC_VERSION: "${VANILLA_MC_VERSION:-1.20.1}"
    restart: unless-stopped
    ports:
      - "${VANILLA_SERVER_PORT:-25567}:25565"
    environment:
      EULA: "${VANILLA_EULA}"
      TYPE: "VANILLA"
      VERSION: "${VANILLA_MC_VERSION:-1.20.1}"
      INIT_MEMORY: "${VANILLA_MEMORY_MIN:-8G}"
      MAX_MEMORY: "${VANILLA_MEMORY_MAX:-15G}"
      SERVER_NAME: "${VANILLA_SERVER_NAME}"
      DIFFICULTY: "${VANILLA_DIFFICULTY}"
      MAX_PLAYERS: "${VANILLA_MAX_PLAYERS}"
      ONLINE_MODE: "${VANILLA_ONLINE_MODE}"
      LEVEL_NAME: "${VANILLA_LEVEL_NAME}"
      SEED: "${VANILLA_SEED}"
      VIEW_DISTANCE: "${VANILLA_VIEW_DISTANCE}"
      ALLOW_NETHER: "${VANILLA_ALLOW_NETHER}"
      ALLOW_FLIGHT: "${VANILLA_ALLOW_FLIGHT}"
      PVP: "${VANILLA_PVP}"
      ENABLE_COMMAND_BLOCK: "${VANILLA_ENABLE_COMMAND_BLOCK}"
      ENABLE_BONUS_CHEST: "${VANILLA_ENABLE_BONUS_CHEST}"
    volumes:
      - ./data/vanilla:/data

  bot:
    container_name: forge-bot
    build:
      context: .
      dockerfile: bot/Dockerfile
    restart: unless-stopped
    environment:
      BOT_ENV_FILE: /app/.env.bot
      PYTHONUNBUFFERED: "1"
    volumes:
      - ./:/app
      - /var/run/docker.sock:/var/run/docker.sock
