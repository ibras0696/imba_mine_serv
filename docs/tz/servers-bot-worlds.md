# ТЗ: второй сервер + управление мирами через бота

## Цели
- Поднять второй сервер “стрелялка” на другом порту.
- Управлять обоими серверами из одного бота (старт/стоп/статус/логи/конфиг).
- Управлять мирами: переключение, загрузка карты (zip/ссылка), вайп.
- Авто‑очистка предметов на обоих серверах.

## Общая схема
- Два сервера в одном репозитории.
- Один бот, переключаемый контекст “Основной/Шутер”.
- Те же моды на обоих серверах.
- Миры независимые, отдельные папки данных.

## Контейнеры и порты
- Основной сервер: порт 25565
- Шутер сервер: порт 25566
- Общая папка модов: `./mods/server` (монтируется в оба сервера)
- Разные папки данных:
  - `./data/main`  → `/data` (основной)
  - `./data/shooter` → `/data` (шутер)

## Миры и переключение
- Используем `LEVEL_NAME` для выбора мира.
- Миры хранятся внутри `/data` каждого сервера:
  - `/data/<world_name>`
- Переключение мира = изменить `LEVEL_NAME` в env + рестарт сервера.

## Загрузка карты
### Источники
- ZIP файл, отправленный боту
- Прямая ссылка на ZIP (http/https)

### Проверки
- Архив должен содержать `level.dat` в корне или в единственной вложенной папке.
- Если структура неверная → ошибка и сервер не трогаем.

### Процесс
1) Остановить выбранный сервер.
2) Бэкап текущего мира (храним 2–3).
3) Скачать/распаковать карту в `/data/<new_world_name>`.
4) Установить `LEVEL_NAME=<new_world_name>`.
5) Запустить сервер.
6) Если ошибка на любом шаге → откат: вернуть старый `LEVEL_NAME`, восстановить бэкап, сообщить пользователю.

### Вайп мира
- Создание нового мира со случайным сидом.
- Реализация: удалить/перенести текущий мир и убрать `SEED` (или оставить пустым), затем рестарт.

## Бэкапы
- Хранить 2–3 последних бэкапа на каждый сервер.
- Формат: zip/тар, имя с датой.
- Папка: `/root/new_sborka_hard/backups/<server_name>/`.

## Бот: UI/UX
### Переключение сервера
- Верхняя кнопка: “Выбрать сервер”.
- Показывает “Основной / Шутер”.
- Выбор сохраняется для пользователя (в памяти; персистентно опционально).

### Кнопки
- Запуск / Остановка / Перезапуск
- Статус (читаемый формат)
- Логи (50/100/200)
- Конфиг (env)
- Моды (список + ссылки)
- Миры

### Миры (новое меню)
- Текущий мир
- Список сохранённых миров
- Переключить
- Загрузить ZIP
- Загрузить по ссылке
- Вайп мира

## Авто‑очистка предметов
- Для каждого сервера отдельно.
- Интервал: 60 минут
- Предупреждения: 30м / 20м / 10м / 5м / 1м / 30с / 5..1
- Чистим только `@e[type=item]`

## Примечания
- Все изменения должны быть в GitHub (репа — источник правды).
- На проде всё подтягивается из GitHub.
- Все действия через бота должны логироваться (минимум: в консоль).

## Открытые вопросы
1) Названия миров по умолчанию:
   - `main_world` и `shooter_world`?
2) Имя для загруженной карты:
   - пользователь вводит имя или ставим `custom_<дата>`?
3) Нужна ли защита от больших архивов? (например >2GB)
